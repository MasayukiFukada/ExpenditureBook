<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
    <head>
        <title>出費管理</title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    </head>
    <script type="text/javascript">
    function onPress_Filter() {
        let year = document.getElementById("select_year").value;
        let month = document.getElementById("select_month").value;
    }

    async function onPress_Register() {
        const status = await postFetch();
        if (status == 200 || status== 201) {
        }

        async function postFetch() {
            const fetchForm = document.getElementById("registerForm");
            const url = fetchForm.getAttribute('action');
            const method = fetchForm.getAttribute('method');
            const send = {
                "id": document.getElementById("txt_id").value,
                "date": document.getElementById("date_register").value,
                "category": document.getElementById("select_category").value,
                "ammount": document.getElementById("txt_ammount").value,
                "note": document.getElementById("txt_note").value
            };
            const data = send;
            const json = JSON.stringify(data);
            try {
                const response = await fetch(url, {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json;charset=utf-8',
                    },
                    body: json,
                });
                if (response.status !== 200 && response.status !== 201) {
                    // 200,201以外ならばエラーメッセージを投げる
                    throw `response.status = ${response.status}, response.statusText = ${response.statusText}`;
                }
                //location.reload();
                return await response.status;
            }
            catch (err) {
                console.log("err: " + err);
            }
            return null;
        }
    }
    </script>
    <body>
        <!-- 編集画面 -->
        <form id="registerForm" action="expenditure_update" method="POST">
            <label for="txt_id">ID:</label>
            <input type="text" id="txt_id" />
            <label for="date_register">登録日:</label>
            <input type="date" id="date_register"/>
            <label for="select_category">カテゴリ:</label>
            <select id="select_category">
                <th:block th:each="data:${categoryMaster}">
                    <option th:value="${data.id.id}" th:text="${data.name}"></option>
                </th:block>
            </select>
            <label for="txt_ammount">金額:</label>
            <input id="txt_ammount" type="number" />
            <label for="txt_note">備考:</label>
            <input id="txt_note" type="text"/>
            <button type="button" onclick="onPress_Register()">登録</button>
        </form>
        <!-- 絞り込み画面 -->
        <p>
            <select id="select_year">
                <th:block th:each="year:${yearSelect}">
                <option th:value="${year}" th:text="${year}"></option>
                </th:block>
            </select>
        </p>
        <p>
            <select id="select_month">
                <th:block th:each="month:${monthSelect}">
                <option th:value="${month}" th:text="${month}"></option>
                </th:block>
            </select>
        </p>
        <p>
            <button type="button" onclick="onPress_Filter()">フィルター</button>
        </p>
        <!-- リスト -->
        <Table>
            <thead>
                <tr>
                    <td>ID</td>
                    <td>日付</td>
                    <td>カテゴリ</td>
                    <td>金額</td>
                    <td>備考</td>
                </tr>
            </thead>
            <tbody>
            <!--
                <th:block th:each="item : ${}">
                <tr onclick="onClick_Table(this)">
                </tr>
                </th:block>
                 -->
            </tbody>
        </Table>
        <a href="/">トップへ戻る</a>
    </body>
</html>
